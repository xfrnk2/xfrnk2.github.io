<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="xfrnk2">
    <meta name="description" content="Bilberry Premium Theme for Hugo.">
    <meta name="keywords" content="blog,personal,responsive,search,font awesome,pages,posts,multilingual,highlight.js,syntax highlighting,premium,shortcuts">
    <meta name="generator" content="Hugo 0.69.0" />
    <title> Django Static &amp; Media 파일 | Rad Blog</title>
    <meta name="description" content="Django Static &amp; Media 파일 - Bilberry Premium Theme for Hugo.">
    <meta itemprop="name" content="Django Static &amp; Media 파일">
    <meta itemprop="description" content="Django Static &amp; Media 파일 - Bilberry Premium Theme for Hugo.">
    <meta property="og:title" content="Django Static &amp; Media 파일">
    <meta property="og:description" content="Django Static &amp; Media 파일 - Bilberry Premium Theme for Hugo.">
    <meta property="og:image" content="https://www.gravatar.com/avatar/88188b6cc451928eba90e8400bc68086?size=200">
    <meta property="og:url" content="https://xfrnk2.github.io/django/django_static_media_file/">
    <meta property="og:site_name" content="Rad Blog">
    <meta property="og:type" content="article">

    


    
    <link href="/django/django_static_media_file/" rel="alternate" type="application/rss+xml" title="Rad Blog" />
    <link href="/django/django_static_media_file/" rel="feed" type="application/rss+xml" title="Rad Blog" />
    

    

    <link rel="stylesheet" href="https://xfrnk2.github.io/theme.css">

    

    
    
    <link rel="stylesheet" href="https://xfrnk2.github.io/wwr11.css">
    
    
</head>

<body class="bilberry-hugo-theme">

    
    <nav>

    <div class="container">
        <ul class="topnav">
            
            
            <li><a href="https://xfrnk2.github.io/page/about/">About</a></li>
            
            
        </ul>

        
        <div id="search-box" class="search">
            <i class="fas fa-search"></i>
            <input id="search" type="text" placeholder="Search ...">
        </div>
        
    </div>
</nav>


    
<header>

    <div class="container">
        <div class="logo">
            <a id="siteBaseUrl" href="/" class="logo">
                
                <img src="/mugen.png" alt="">
                

                <span class="overlay"><i class="fa fa-home"></i></span>
            </a>
        </div>
        <div class="titles">
            <h3 class="title"><a
                    href="/">Rad Blog</a></h3>
            
            <span class="subtitle">Archive</span>
            
        </div>


        
            <div class="toggler">
                
                <i class="fa fa-bars" aria-hidden="true"></i>
            </div>
        </div>
</header>


    <div class="main container">
        
     
    <div class="article-wrapper u-cf single">
        
            <a class="bubble" href="https://xfrnk2.github.io/django/django_static_media_file/">
    <i class="fas fa-fw fa-code"></i>
</a>

<article class="default article">
    

    <div class="content">
    <h1 class="article-title"><a href="https://xfrnk2.github.io/django/django_static_media_file/">Django Static &amp; Media 파일</a></h1>
    <div class="meta">
        
        
        <span class="date moment">2020-04-28</span>
        
        

        

        
        <span class="categories">
            
                
                <a href="https://xfrnk2.github.io/categories/django/">Django</a>
                
            
        </span>
        

        
        <span class="author">
            
            <a href="https://xfrnk2.github.io/author/xfrnk2/">xfrnk2</a>
            
        </span>
        
    </div>

    
    <blockquote>
<p>이진석 선생님의 <a href="https://educast.com/course/web/ZU53">리액트와 함께 장고 시작하기</a> 수강중 정리한 글입니다.</p>
</blockquote>
<hr>
<h3 id="static--media-파일">Static &amp; Media 파일</h3>
<ul>
<li>Static 파일 : 개발 리소스로서의 정적인 파일(js, css, image 등)</li>
<li>앱 또는 프로젝트 단위로 저장 및 서빙</li>
</ul>
<hr>
<h3 id="media-파일-장고에만-있는">Media 파일 (장고에만 있는)</h3>
<ul>
<li>FileField/ImageField를 통해 저장한 모든 파일</li>
<li>DB필드에는 저장 경로를 저장하며, 파일은 파일 스토리지에 저장</li>
<li>실제로 문자열을 저장하는 필드(중요) -&gt; 파일은 스토리지에 저장, 경로 문자열이 저장</li>
<li>프로젝트 단위로 저장 및 서빙</li>
</ul>
<hr>
<h3 id="media-파일-처리-순서">Media 파일 처리 순서</h3>
<ol>
<li>HttpRequest.FILES를 통해 파일이 전달</li>
<li>뷰 로직이나 폼 로직을 통해, 유효성 검증을 수행</li>
<li>FileFIeld/ImageField 필드에 &ldquo;경로(문자열)&ldquo;를 저장</li>
<li>setings.MEDIA_ROOT 경로에 파일을 저장</li>
</ol>
<h6 id="코드-예시">코드 예시</h6>
<pre><code>MEDIA_URL = '/media/'
MEDIA_ROOT = os.path.join(BASE_DIR, '..', 'public', 'media')
</code></pre><blockquote>
<p>예) MEDIA_ROOT의 경우, 상위 디렉토리(..)의 public/media에 저장</p>
</blockquote>
<hr>
<h3 id="file-field">File Field</h3>
<ul>
<li>File Storage API를 통해 파일 저장</li>
<li>장고에서는 FIle System Storage만 지원, django-storages를 통해 확장 지원</li>
<li>해당 필드 옵션필드로 두고자 하면 _blank=True 적용</li>
</ul>
<hr>
<h3 id="imagefield-file-field-상속">ImageField (File Field 상속)</h3>
<ul>
<li>Image Field 는 Pillow 이미지 처리 라이브러리 설치를 통해 width와 height 획득</li>
<li>미설치시 ImageField를 추가한 makemigrations 수행에 실패</li>
<li>빈 경로 처리여부 : blank=True의 디폴트 설정은 false</li>
</ul>
<h6 id="위-필드를-상속-받은-커스텀-필드를-만들-수-있다">위 필드를 상속 받은 커스텀 필드를 만들 수 있다.</h6>
<hr>
<h3 id="사용할-만한-필드-옵션">사용할 만한 필드 옵션</h3>
<h6 id="-blank">　 blank</h6>
<ul>
<li>업로드 옵션 처리여부</li>
<li>default : False</li>
</ul>
<h6 id="-upload_to">　 upload_to</h6>
<ul>
<li>settings.MEDIA_ROOT 하위에서 저장한 파일명/경로명 결정</li>
<li>default : 파일명 그대로 settings.MEDIA_ROOT에 저장</li>
<li>성능을 위해 한 디렉토리에 너무 많은 파일이 저장되지 않도록 조정하는 역할(추천)</li>
<li>동일 파일명으로 저장시에 파일명에 더미 문자열을 붙여 파일 덮어쓰기 방지</li>
</ul>
<h6 id="upload_to-주의사항">　upload_to 주의사항</h6>
<ul>
<li>지정하지 않을 경우 MEDIA_ROOT 밑에 파일을 저장</li>
<li>파일 저장시에 upload_to 인자를 변경한다고 해서, DB에 저장된 경로값이 갱신되지는 않음</li>
</ul>
<h6 id="upload_to-인자-유형">　upload_to 인자 유형</h6>
<ul>
<li>문자열로 지정 : 파일을 저장할 &ldquo;중간 디렉토리 경로&quot;로서 활용</li>
<li>함수로 지정 : &ldquo;중간 디렉토리 경로&rdquo; 및 &ldquo;파일명&quot;까지 결정 가능</li>
</ul>
<hr>
<h3 id="파일-저장-경로--커스텀-upload_to-옵션">파일 저장 경로 / 커스텀 upload_to 옵션</h3>
<p>한 디렉토리에 파일을 너무 많이 몰아둘 경우, OS 파일찾기 성능 저하. 디렉토리 Depth가 깊어지는 것은 성능에 큰 영향 없음. 필드 별로, 다른 디렉토리 저장경로를 가질 것을 권장</p>
<h6 id="대책-1-필드-별로-다른-디렉토리에-저장">대책 1) 필드 별로 다른 디렉토리에 저장</h6>
<ul>
<li>photo = models.ImageField(upload_to=&quot;blog&rdquo;)</li>
<li>photo = models.ImageField(upload_to=&quot;blog/photo&rdquo;)</li>
</ul>
<h6 id="대책-2-업로드-시간대-별로-다른-디렉토리에-저장">대책 2) 업로드 시간대 별로 다른 디렉토리에 저장</h6>
<ul>
<li>upload_to에서 strftime 포맷팅을 지원</li>
<li>photo = models.ImageField(upload_to=&quot;blog/%Y/%m/%d&rdquo;)</li>
</ul>
<hr>
<h3 id="uuid를-통한-파일명-정하기-예시">uuid를 통한 파일명 정하기 예시</h3>
<pre><code>import os
from uuid import uuid4 
from django.utils import timezone

  
def uuid_name_upload_to(instance, filename):
	app_label = instance.__class__._meta.app_label 	# 앱 별로
	cls_name = instance. __class__.__name__.lower()# 모델 별로
	ymd_path = timezone.now().strftime('%Y/%m/%d') 	# 업로드하는 년/월/일 별로 
	uuid_name = uuid4().hex
	extension = os.path.splitext(filename)[-1].lower() #파일명과 확장자로 분리
	return '/'.join([
			app_label, 
			cls_name, 
			ymd_path, 
			uuid_name[:2], 
			uuid_name + extension,
	])

</code></pre><h6 id="uuid의-사용">uuid의 사용</h6>
<pre><code>&gt;&gt;&gt; from uuid import uuid4 
&gt;&gt;&gt; uuid4()
UUID('2456b825-1e40-4da5-a8a8-114afb1b2ec4')
&gt;&gt;&gt; uuid4().hex
'be8a02e5b8bd41c883d09afba142a6c9'
</code></pre><h6 id="splitext의-사용">splitext의 사용</h6>
<pre><code>&gt;&gt;&gt; from os.path import splitext
&gt;&gt;&gt; splitext('c:/hello/python.py') # 확장자가 없으면 두번째 원소로 ''를 반환
('c:/hello/python', '.py') # splitext('경로')[-1]과 같은 형태로 사용
</code></pre><hr>
<h3 id="개발환경에서의-media-파일-서빙">개발환경에서의 media 파일 서빙</h3>
<ul>
<li>static 파일과 다르게, 장고 개발서버에서 서빙 미지원</li>
<li>개발 편의성 목적으로 직접 서빙 Rule 추가 가능</li>
</ul>
<pre><code>from django.conf import settings
from django.conf.urls.static import static
# 중략
urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
</code></pre><hr>
<h3 id="file-upload-handler">File Upload Handler</h3>
<h6 id="파일-크기가-25mb-이하의-경우">파일 크기가 2.5MB 이하의 경우</h6>
<ul>
<li>메모리에 담겨 전달</li>
<li>MemoryFileUploadHandler</li>
</ul>
<h6 id="파일-크기가-25mb-초과일-경우">파일 크기가 2.5MB 초과일 경우</h6>
<ul>
<li>디스크에 담겨 전달</li>
<li>TemporaryFileUploadHandler</li>
</ul>
<h6 id="관련-설정">관련 설정</h6>
<ul>
<li>settings.FILE_UPOLAD_MAX_MEMORY_SIZE</li>
<li>-&gt; 2.5MB</li>
</ul>
<hr>
<h3 id="기타-팁">기타 팁</h3>
<h6 id="ㅇ-if-settingsdebug-in-urlspy">ㅇ if settings.DEBUG: in urls.py</h6>
<pre><code>if settings.DEBUG:
    urlpatterns += static.static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
</code></pre><ul>
<li>파일을 읽어서 응답을 주기 위한 방법 (urls.py)</li>
<li>장고는 미디어 파일등의 스테틱 파일의 서빙을 실제 프로덕션에서 하는 것을 권장하지 않음</li>
<li>만약 if 문을 한 줄 없앤다 해도 빈 리스트를 반환하게 되지만, 명시적으로 사용하기 위해서 if문을 사용</li>
</ul>
<h6 id="ㅇ-mark_safe">ㅇ mark_safe()</h6>
<ul>
<li>url로 표시되는것은 django의 feature</li>
<li>django.utils.safestring.mark_safe() 가 경로</li>
<li>url이 아닌 이미지가 정상적으로 나올수 있게 함</li>
</ul>
<h6 id="ㅇ-조회">ㅇ 조회</h6>
<pre><code>&gt;&gt;&gt; a = Post.objects.all()[2]
&lt;Post: 세번째&gt;
&gt;&gt;&gt; a.photo.url
'/media/%EA%B7%B8%EC%9C%BC%EB%9E%98.jpg'
&gt;&gt;&gt; a.photo.path
'C:\\Users\\rad87\\Documents\\programming\\mysite\\django_tech\\이미지.jpg'
</code></pre><h6 id="ㅇ-settings의-import">ㅇ settings의 import</h6>
<blockquote>
<p>settings는 기본적으로 django.conf의 global_settings와, 현재 프로젝트의 settings가 합쳐져야 되므로
from django.conf import 현 프로젝트의 settings인 settings 로 하면 합쳐짐(오버라이팅)</p>
</blockquote>
<pre><code># from django.conf import global_settings
# from django_tech import settings
from django.conf import settings
</code></pre><hr>
<h3 id="개인-질문">개인 질문</h3>
<ul>
<li>강사님께 1:1로 질문 드려본 결과 아래와 같은 친절한 답변을 받았다.</li>
</ul>
<h6 id="q-">Q :</h6>
<p>옵션필드라는 것은 무엇인가요?</p>
<h6 id="a-">A :</h6>
<p>장고에서는 Form기능을 통해, 유저에게 입력폼을 제공하고, 유저가 입력한 값에 대한 유효성 검사를 수행합니다.
옵션필드라는 말의 의미는, 해당 값에 대해서 값 입력을 요구하지 않겠다는 의미입니다.
blank=True는 문자열 필드에 대해서 적용하구요. 값 입력이 없는 빈 문자열 상황을 허용하겠다는 것입니다.
FileField/ImageField는 CharField를 상속받은 필드입니다. 문자열 특성을 가지고 있다고 볼 수 있습니다. 실제로 db에는 파일 경로 문자열을 저장합니다. blank=True로 지정했다는 것은 파일을 지정하지 않은 상황을 허용하고, 이때 db에는 빈 문자열 경로를 저장합니다.</p>
<p>(값이 필수가 아니여도 된다는 의미)</p>
<h6 id="-친절하게-해주신-설명으로-명쾌하게-이해되었다">+ 친절하게 해주신 설명으로 명쾌하게 이해되었다!</h6>

    
</div>

    
<div class="footer">


    
        <div class="tags">
            <i class="fa fa-tags"></i>
            <div class="links">
                
                
                <a href="https://xfrnk2.github.io/tags/django/">Django</a>
                
                
            </div>
        </div>
    

    
</div>

</article>

        
    </div>

    
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "xfrnk2-github-io" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

     

    </div>

    
<footer>
    <div class="container">

        
        <div class="recent-posts">
            <a href="/"><strong>Latest posts</strong></a>
            <ul>
                
                <li>
                    <a href="https://xfrnk2.github.io/react/react_event/">React(리액트)_Event(이벤트)</a>
                </li>
                
                <li>
                    <a href="https://xfrnk2.github.io/til/20.09.03/">20.09.03_TIL</a>
                </li>
                
                <li>
                    <a href="https://xfrnk2.github.io/javascript/javascript_memo/">Javascript Memo</a>
                </li>
                
                <li>
                    <a href="https://xfrnk2.github.io/til/20.09.02/">20.09.02_TIL</a>
                </li>
                
                <li>
                    <a href="https://xfrnk2.github.io/react/react_component/">React(리액트)_component 작성시 props와 javascript의 활용</a>
                </li>
                
                <li>
                    <a href="https://xfrnk2.github.io/react/react_react/">React(리액트)_에 대해서</a>
                </li>
                
                <li>
                    <a href="https://xfrnk2.github.io/til/20.09.01/">20.09.01_TIL</a>
                </li>
                
            </ul>
        </div>
        

        
        <div class="categories">
            <a href="/categories/"><strong>Categories</strong></a>
            <ul>
                
                <li>
                    <a href="/categories/til">Til
                        </a>
                </li>
                
                <li>
                    <a href="/categories/django">Django
                        </a>
                </li>
                
                <li>
                    <a href="/categories/boj">Boj
                        </a>
                </li>
                
                <li>
                    <a href="/categories/database">Database
                        </a>
                </li>
                
                <li>
                    <a href="/categories/docker">Docker
                        </a>
                </li>
                
                <li>
                    <a href="/categories/react">React
                        </a>
                </li>
                
                <li>
                    <a href="/categories/algorithm">Algorithm
                        </a>
                </li>
                
            </ul>
        </div>
        
		
		
        <div class="tags">
            <a href="/tags/"><strong>Tags</strong></a>
            <ul>
                
                <li>
                    <a href="/tags/til">Til
                        </a>
                </li>
                
                <li>
                    <a href="/tags/django">Django
                        </a>
                </li>
                
                <li>
                    <a href="/tags/algorithm">Algorithm
                        </a>
                </li>
                
                <li>
                    <a href="/tags/boj">Boj
                        </a>
                </li>
                
                <li>
                    <a href="/tags/model">Model
                        </a>
                </li>
                
                <li>
                    <a href="/tags/sorting">Sorting
                        </a>
                </li>
                
                <li>
                    <a href="/tags/database">Database
                        </a>
                </li>
                
            </ul>
        </div>
        
		
		
		

        <div class="right">
            
            <div class="external-profiles">
                <strong>Social media</strong>

                
                <a href="https://github.com/xfrnk2" target="_blank"><i class="fab fa-github"></i></a>
                
            </div>
            
        </div>
    </div>
</footer>


<div class="credits">
    <div class="container">
        <div class="copyright">
            <a href="https://github.com/xfrnk2" target="_blank">
                &copy;
                
                2020
                
                by xfrnk2
            </a>
            
        </div>
        <div class="author">
            <a href="https://github.com/Lednerb/bilberry-hugo-theme"
                target="_blank">Bilberry Hugo Theme</a>
        </div>
    </div>
</div>


    

    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [['$','$'], ['\\(','\\)']]}
        });
</script>

    


    <script type="text/javascript" src="https://xfrnk2.github.io/theme.js"></script>

    
    
    

    
    <div id="activate-algolia-search" class="hidden">
  <input type="hidden" id="algolia-search-appId" value="4ML69MKPKO">
  <input type="hidden" id="algolia-search-apiKey" value="568ba12efff051120f3587e1d297c4cd">
  <input type="hidden" id="algolia-search-indexName" value="xfrnk2">
  <input type="hidden" id="algolia-search-noSearchResults" value="Nothing found.">

  
  <input type="hidden" id="algolia-search-currentLanguageOnly">
  
</div>

    


</body>

</html>
